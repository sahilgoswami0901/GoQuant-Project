<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Exception handling and stack unwinding for x64."><title>goblin::pe::exception - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-84e720fa.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="goblin" data-themes="" data-resource-suffix="" data-rustdoc-version="1.89.0 (29483883e 2025-08-04)" data-channel="1.89.0" data-search-js="search-92309212.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-4e99c027.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-fd3af306.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../goblin/index.html">goblin</a><span class="version">0.5.4</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module exception</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In goblin::<wbr>pe</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">goblin</a>::<wbr><a href="../index.html">pe</a></div><h1>Module <span>exception</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/goblin/pe/exception.rs.html#1-1058">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Exception handling and stack unwinding for x64.</p>
<p>Exception information is exposed via the <a href="struct.ExceptionData.html"><code>ExceptionData</code></a> structure. If present in a PE file,
it contains a list of <a href="struct.RuntimeFunction.html"><code>RuntimeFunction</code></a> entries that can be used to get <a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a> for a
particular code location.</p>
<p>Unwind information contains a list of unwind codes which specify the operations that are
necessary to restore registers (including the stack pointer RSP) when unwinding out of a
function.</p>
<p>Depending on where the instruction pointer lies, there are three strategies to unwind:</p>
<ol>
<li>
<p>If the RIP is within an epilog, then control is leaving the function, there can be no
exception handler associated with this exception for this function, and the effects of the
epilog must be continued to compute the context of the caller function. To determine if the
RIP is within an epilog, the code stream from RIP on is examined. If that code stream can be
matched to the trailing portion of a legitimate epilog, then it’s in an epilog, and the
remaining portion of the epilog is simulated, with the context record updated as each
instruction is processed. After this, step 1 is repeated.</p>
</li>
<li>
<p>Case b) If the RIP lies within the prologue, then control has not entered the function,
there can be no exception handler associated with this exception for this function, and the
effects of the prolog must be undone to compute the context of the caller function. The RIP
is within the prolog if the distance from the function start to the RIP is less than or
equal to the prolog size encoded in the unwind info. The effects of the prolog are unwound
by scanning forward through the unwind codes array for the first entry with an offset less
than or equal to the offset of the RIP from the function start, then undoing the effect of
all remaining items in the unwind code array. Step 1 is then repeated.</p>
</li>
<li>
<p>If the RIP is not within a prolog or epilog and the function has an exception handler, then
the language-specific handler is called. The handler scans its data and calls filter
functions as appropriate. The language-specific handler can return that the exception was
handled or that the search is to be continued. It can also initiate an unwind directly.</p>
</li>
</ol>
<p>For more information, see <a href="https://docs.microsoft.com/en-us/cpp/build/exception-handling-x64?view=vs-2017">x64 exception handling</a>.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.ExceptionData.html" title="struct goblin::pe::exception::ExceptionData">Exception<wbr>Data</a></dt><dd>Exception handling and stack unwind information for functions in the image.</dd><dt><a class="struct" href="struct.Register.html" title="struct goblin::pe::exception::Register">Register</a></dt><dd>An x64 register used during unwinding.</dd><dt><a class="struct" href="struct.RuntimeFunction.html" title="struct goblin::pe::exception::RuntimeFunction">Runtime<wbr>Function</a></dt><dd>An unwind entry for a range of a function.</dd><dt><a class="struct" href="struct.RuntimeFunctionIterator.html" title="struct goblin::pe::exception::RuntimeFunctionIterator">Runtime<wbr>Function<wbr>Iterator</a></dt><dd>Iterator over runtime function entries in <a href="struct.ExceptionData.html"><code>ExceptionData</code></a>.</dd><dt><a class="struct" href="struct.UnwindCode.html" title="struct goblin::pe::exception::UnwindCode">Unwind<wbr>Code</a></dt><dd>An unwind operation that is executed at a particular place in the function prolog.</dd><dt><a class="struct" href="struct.UnwindCodeIterator.html" title="struct goblin::pe::exception::UnwindCodeIterator">Unwind<wbr>Code<wbr>Iterator</a></dt><dd>An iterator over unwind codes for a function or part of a function, returned from
<a href="struct.UnwindInfo.html"><code>UnwindInfo</code></a>.</dd><dt><a class="struct" href="struct.UnwindInfo.html" title="struct goblin::pe::exception::UnwindInfo">Unwind<wbr>Info</a></dt><dd>Unwind information for a function or portion of a function.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.StackFrameOffset.html" title="enum goblin::pe::exception::StackFrameOffset">Stack<wbr>Frame<wbr>Offset</a></dt><dd>An unsigned offset to a value in the local stack frame.</dd><dt><a class="enum" href="enum.UnwindHandler.html" title="enum goblin::pe::exception::UnwindHandler">Unwind<wbr>Handler</a></dt><dd>A language-specific handler that is called as part of the search for an exception handler or as
part of an unwind.</dd><dt><a class="enum" href="enum.UnwindOperation.html" title="enum goblin::pe::exception::UnwindOperation">Unwind<wbr>Operation</a></dt><dd>An unwind operation corresponding to code in the function prolog.</dd></dl></section></div></main></body></html>